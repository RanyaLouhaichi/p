<atlassian-plugin key="${atlassian.plugin.key}" name="${project.name}" plugins-version="2">
    <plugin-info>
        <description>${project.description}</description>
        <version>${project.version}</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}"/>
    </plugin-info>

    <!-- Resources -->
    <resource type="i18n" name="i18n" location="jurix-ai-plugin"/>
    
    <!-- Web Resources -->
    <web-resource key="jurix-ai-resources" name="JURIX AI Web Resources">
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        
        <resource type="download" name="jurix-ai.css" location="/css/jurix-ai.css"/>
        <resource type="download" name="dashboard.js" location="/js/dashboard.js"/>
        <resource type="download" name="chat-widget.js" location="/js/chat-widget.js"/>
        <resource type="download" name="smart-suggestions.js" location="/js/smart-suggestions.js"/>
        <resource type="download" name="live-suggestions.js" location="/js/live-suggestions.js"/>
        
        <context>atl.general</context>
        <context>jira.global</context>
        <context>jira.navigator.simple</context>
        <context>jira.navigator.advanced</context>
        <context>jira.create</context>
    </web-resource>

    <!-- REMOVE THIS ENTIRE SECTION - Active Objects is causing the error -->
    <!--
    <ao key="ao-module" name="Active Objects Module">
        <description>The Active Objects module for this plugin.</description>
        <entity>com.jurix.ai.ao.AIAnalytics</entity>
        <entity>com.jurix.ai.ao.GeneratedArticle</entity>
        <entity>com.jurix.ai.ao.Prediction</entity>
        <entity>com.jurix.ai.ao.DashboardUpdate</entity>
    </ao>
    -->
    
    <!-- Component Imports for Dependency Injection -->
    <component-import key="userManager" interface="com.atlassian.sal.api.user.UserManager"/>
    <component-import key="pluginSettingsFactory" interface="com.atlassian.sal.api.pluginsettings.PluginSettingsFactory"/>
    <component-import key="templateRenderer" interface="com.atlassian.templaterenderer.TemplateRenderer"/>
    <component-import key="eventPublisher" interface="com.atlassian.event.api.EventPublisher"/>
    
    <!-- REMOVE THESE TOO - Not needed without Active Objects -->
    <!--
    <component-import key="activeObjects" interface="com.atlassian.activeobjects.external.ActiveObjects"/>
    <component-import key="cacheManager" interface="com.atlassian.cache.CacheManager"/>
    -->

    <!-- Component Declarations -->
    <component key="jurixConfiguration" class="com.jurix.ai.config.JurixConfiguration"/>
    <component key="chatService" class="com.jurix.ai.rest.ChatService"/>
    
    <!-- Service Components -->
    <component key="notificationService" class="com.jurix.ai.service.NotificationService"/>
    <component key="dashboardService" class="com.jurix.ai.service.DashboardService"/>
    
    <!-- Dashboard Update Service - Keep this, it's now using in-memory storage -->
    <component key="dashboardUpdateService" class="com.jurix.ai.service.DashboardUpdateService">
        <description>Service for tracking dashboard updates</description>
    </component>

    <!-- Issue Event Listener - Keep this -->
    <component key="issueEventListener" class="com.jurix.ai.listener.IssueEventListener">
        <description>Listens to issue events for real-time dashboard updates</description>
    </component>
    
    <!-- REST Module - This will auto-discover @Named REST classes -->
    <rest name="JURIX REST API" key="jurix-rest" path="/jurix" version="1.0">
        <description>REST endpoints for JURIX AI Assistant</description>
    </rest>
    
    <!-- Dashboard Servlet -->
    <servlet key="dashboard-servlet" name="Dashboard Servlet" 
             class="com.jurix.ai.servlet.DashboardServlet">
        <description>Serves the AI dashboard</description>
        <url-pattern>/jurix-dashboard</url-pattern>
    </servlet>
    
    <!-- Simple Test Servlet -->
    <servlet key="test-servlet" name="Test Servlet" 
             class="com.jurix.ai.servlet.TestServlet">
        <description>Test servlet</description>
        <url-pattern>/jurix-test</url-pattern>
    </servlet>
    
    <!-- Web Item for Project Navigation -->
    <web-item key="jurix-dashboard-link" name="AI Dashboard Link" 
              section="jira.project.sidebar.navigation" weight="30">
        <description>Link to AI Dashboard</description>
        <label key="jurix.dashboard.label">AI Analytics</label>
        <link linkId="jurix-dashboard-link">/plugins/servlet/jurix-dashboard?projectKey=$projectKey</link>
        <condition class="com.atlassian.jira.plugin.webfragment.conditions.UserLoggedInCondition"/>
    </web-item>

    <!-- Smart Suggestions Panel -->
    <web-panel key="smart-suggestions-panel" name="Smart Article Suggestions Panel" 
            location="atl.jira.view.issue.left.context" weight="150">
        <description>Shows AI-powered article suggestions for the current issue</description>
        <context-provider class="com.jurix.ai.panel.SmartSuggestionsPanelProvider"/>
        <resource name="view" type="velocity" location="/templates/smart-suggestions-panel.vm"/>
        <condition class="com.atlassian.jira.plugin.webfragment.conditions.UserLoggedInCondition"/>
    </web-panel>
</atlassian-plugin>